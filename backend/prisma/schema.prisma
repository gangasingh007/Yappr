generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String         @id @default(uuid())
  clerkId        String
  fullName       String?    
  email          String
  chats          Chat[]         @relation("ParticipantA")
  chatsB         Chat[]         @relation("ParticipantB")
  messages       Message[]
  avatar         String         @default("https://images.unsplash.com/photo-1740252117070-7aa2955b25f8?w=700&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OHx8cHJvZmlsZSUyMGljb258ZW58MHx8MHx8fDA%3D")  
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model Chat {
  id             String       @id @default(uuid())
  participantA   User         @relation("ParticipantA", fields: [participantAId], references: [id])
  participantAId String
  participantB   User         @relation("ParticipantB", fields: [participantBId], references: [id])
  participantBId String
  messages       Message[]
  lastMessage    String?
  lastMessageAt  DateTime?    @default(now())
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@unique([participantAId, participantBId])
  @@index([participantAId, participantBId])
}


model Message {
  id         String    @id @default(uuid())
  chat       Chat      @relation(fields: [chatId], references: [id])
  chatId     String
  sender     User      @relation(fields: [senderId], references: [id])
  senderId   String
  text       String
  readAt     DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}